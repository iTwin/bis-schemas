<?xml version="1.0" encoding="UTF-8"?>
<!-- =====================================================================================
|
|     $Source: Egress.ecschema.xml $
|
|  $Copyright: (c) 2018 Bentley Systems, Incorporated. All rights reserved. $
|
======================================================================================= -->
<ECSchema schemaName="Egress" nameSpacePrefix="egr" version="01.00" xmlns="http://www.bentley.com/schemas/Bentley.ECXML.3.0">
  <ECSchemaReference name="BisCore" version="01.00" prefix="bis" />
  <ECSchemaReference name="BuildingSpacePlanning" version="01.00" prefix="bsp" />

  <KindOfQuantity typeName="Length" description="Length" persistenceUnit="M" relativeError="1e-6" presentationUnits="FT(fi8)"/>
  <KindOfQuantity typeName="Area" description="Area" persistenceUnit="SQ.M" relativeError="1e-6" presentationUnits="SQ.FT(fi8)"/>
  
  <ECEntityClass typeName="EgressPath" displayLabel="Egress Path">
    <BaseClass>bis:SpatialLocationElement</BaseClass>
    <ECCustomAttributes>
      <ClassHasHandler xmlns="BisCore.01.00" />
    </ECCustomAttributes>
    <ECProperty propertyName="Length" displayLabel="Length" typeName="double" readOnly="true" kindOfQuantity="Length"/>
    <ECProperty propertyName="IsPrimary" displayLabel="isPrimary" typeName="boolean" readOnly="true"/>
    <ECNavigationProperty propertyName="Source" relationshipName="EgressPathHasSourceElement" direction="Forward" description="Element that path goes from" />
    <ECNavigationProperty propertyName="Target" relationshipName="EgressPathHasTargetElement" direction="Forward" description="Element that path goes to" />
  </ECEntityClass>

  <ECRelationshipClass typeName="EgressPathHasSourceElement" strength="referencing" strengthDirection="backward" modifier="None">
    <Source multiplicity="0..1" roleLabel="starts from" polymorphic ="false">
      <Class class="EgressPath"/>
    </Source>
    <Target multiplicity="0..1" roleLabel="has" polymorphic="true">
      <Class class ="bis:SpatialLocationElement"/>
    </Target>
  </ECRelationshipClass>

  <ECRelationshipClass typeName="EgressPathHasTargetElement" strength="referencing" strengthDirection="backward" modifier="None">
    <Source multiplicity="0..1" roleLabel="goes to" polymorphic ="false">
      <Class class="EgressPath"/>
    </Source>
    <Target multiplicity="0..1" roleLabel="has" polymorphic="true">
      <Class class ="bis:SpatialLocationElement"/>
    </Target>
  </ECRelationshipClass>

  <ECEntityClass typeName="EgressPathSection" displayLabel="Egress Path Section">
    <BaseClass>bis:SpatialLocationElement</BaseClass>
    <ECCustomAttributes>
      <ClassHasHandler xmlns="BisCore.01.00"/>
    </ECCustomAttributes>
    <ECProperty propertyName="Length" displayLabel="Length" typeName="double" readOnly="true" kindOfQuantity="Length"/>
    <ECProperty propertyName="PassingPeople" displayLabel="PassingPeople" typeName="int" readOnly="true"/>
    <ECNavigationProperty propertyName="PassedSpace" relationshipName="EgressPathSectionGoesThroughSpace" direction="Forward" description="Space that section goes through" />
  </ECEntityClass>

  <ECRelationshipClass typeName="EgressPathSectionGoesThroughSpace" strength="referencing" strengthDirection="backward" modifier="None">
    <Source multiplicity="(0..1)" roleLabel="goes through" polymorphic="false">
      <Class class="EgressPathSection"/>
    </Source>
    <Target multiplicity="(0..1)" roleLabel="has" polymorphic="false">
      <Class class="bsp:Space"/>
    </Target>
  </ECRelationshipClass>

  <ECRelationshipClass typeName="EgressPathHasSections" strength="referencing">
    <BaseClass>bis:ElementRefersToElements</BaseClass>
    <Source cardinality="(0,N)" roleLabel="owns sections" polymorphic="true">
      <Class class="EgressPath"/>
    </Source>
    <Target cardinality="(0,N)" roleLabel="composes" polymorphic="true">
      <Class class="EgressPathSection"/>
    </Target>
    <ECProperty propertyName="Index" displayLabel="Index" typeName="int"/>
  </ECRelationshipClass>

  <ECRelationshipClass typeName="EgressSectionConnectsElements" strength="referencing">
    <BaseClass>bis:ElementRefersToElements</BaseClass>
    <Source cardinality="(0,N)" polymorphic="false">
      <Class class="EgressPathSection"/>
    </Source>
    <Target cardinality="(0,N)" polymorphic="true">
      <Class class="bis:SpatialLocationElement"/>
      <!--Should be able to hold both spaces and openings-->
    </Target>
    <ECProperty propertyName="IsSource" displayLabel="IsSource" typeName="boolean"/>
  </ECRelationshipClass>

</ECSchema>
