<?xml version="1.0" encoding="UTF-8"?>
<ECSchema schemaName="Simulation4DResults" alias="simul4d" version="1.0.0-beta.1" xmlns="http://www.bentley.com/schemas/Bentley.ECXML.3.1">
    <ECSchemaReference name="BisCore" version="01.00.01" alias="bis"/>
    <ECSchemaReference name="ECDbMap" version="02.00.00" alias="ecdbmap"/>
    <ECSchemaReference name="CoreCustomAttributes" version="01.00.00" alias="CoreCA"/>

    <ECEntityClass typeName="SpatioTemporalSimulationResults" description="Defines a element type containing 4D simulation results">
        <BaseClass>bis:InformationRecordElement</BaseClass>
        <BaseClass>bis:IParentElement</BaseClass>
        <ECCustomAttributes>
            <ClassHasHandler xmlns="BisCore.1.0"/>
        </ECCustomAttributes>
        <ECProperty propertyName="Duration" typeName="double" description="Duration of the simulation (in seconds)" displayLabel="Duration">
            <ECCustomAttributes>
                <CustomHandledProperty/>
            </ECCustomAttributes>
        </ECProperty>
    </ECEntityClass>
	
	<!-- Question: is there something similar in BIS and how is this compatible with Navigator? -->
    <ECEntityClass typeName="Camera" description="Represents a camera">
        <BaseClass>bis:InformationRecordElement</BaseClass>
        <ECCustomAttributes>
            <ClassHasHandler xmlns="BisCore.1.0"/>
        </ECCustomAttributes>
        <ECProperty propertyName="Position" typeName="point3d" description="Camera position in the scene" displayLabel="Position">
            <ECCustomAttributes>
                <CustomHandledProperty/>
            </ECCustomAttributes>
        </ECProperty>
        <ECProperty propertyName="ForwardVector" typeName="point3d" description="Normalized camera direction" displayLabel="Forward Vector">
            <ECCustomAttributes>
                <CustomHandledProperty/>
            </ECCustomAttributes>
        </ECProperty>
        <ECProperty propertyName="UpVector" typeName="point3d" description="Direction the top of the camera should face" displayLabel="Up Vector">
            <ECCustomAttributes>
                <CustomHandledProperty/>
            </ECCustomAttributes>
        </ECProperty>
        <ECProperty propertyName="FieldOfView" typeName="double" description="Field of view in degrees" displayLabel="Field Of View">
            <ECCustomAttributes>
                <CustomHandledProperty/>
            </ECCustomAttributes>
        </ECProperty>
		<ECProperty propertyName="ProjectionMode" typeName="CameraProjectionMode_Type" description="Camera projection mode ( perspective / isometric )" displayLabel="Projecttion Mode">
            <ECCustomAttributes>
                <CustomHandledProperty/>
            </ECCustomAttributes>
        </ECProperty>
    </ECEntityClass>
	
    <ECEntityClass typeName="CameraKeyframe" description="Defines a keyframe for camera">
        <BaseClass>bis:ElementMultiAspect</BaseClass>
        <ECCustomAttributes>
            <ClassHasHandler xmlns="BisCore.1.0"/>
        </ECCustomAttributes>
        <ECProperty propertyName="KeyframeTime" typeName="double" description="Time (in seconds) of the keyframe" displayLabel="Keyframe Time">
            <ECCustomAttributes>
                <CustomHandledProperty/>
            </ECCustomAttributes>
        </ECProperty>
        <ECProperty propertyName="Interpolation" typeName="Interpolation_Type" description="Interpolation type used between the current keyframe and the next one" displayLabel="Interpolation">
            <ECCustomAttributes>
                <CustomHandledProperty/>
            </ECCustomAttributes>
        </ECProperty>
        <ECNavigationProperty propertyName="CameraValue" relationshipName="CameraKeyframeControlsCamera" direction="forward" description="Camera parameters" displayLabel="Camera Value">
            <ECCustomAttributes>
                <CustomHandledProperty/>
            </ECCustomAttributes>
        </ECNavigationProperty>
    </ECEntityClass>

    <ECEntityClass typeName="AnimationGroup">
        <BaseClass>bis:GroupInformationElement</BaseClass>
        <ECCustomAttributes>
            <ClassHasHandler xmlns="BisCore.1.0"/>
        </ECCustomAttributes>
    </ECEntityClass>

    <ECEntityClass typeName="AnimationInstance">
        <BaseClass>bis:InformationRecordElement</BaseClass>
        <ECCustomAttributes>
            <ClassHasHandler xmlns="BisCore.1.0"/>
        </ECCustomAttributes>
    </ECEntityClass>
	
    <ECEntityClass typeName="Keyframe" description="Defines a generic keyframe for animation of instances">
        <BaseClass>bis:ElementMultiAspect</BaseClass>
        <ECCustomAttributes>
            <ClassHasHandler xmlns="BisCore.1.0"/>
        </ECCustomAttributes>
        <ECProperty propertyName="KeyframeTime" typeName="double" description="Time (in seconds) of the keyframe" displayLabel="Keyframe Time">
            <ECCustomAttributes>
                <CustomHandledProperty/>
            </ECCustomAttributes>
        </ECProperty>
        <ECProperty propertyName="Interpolation" typeName="Interpolation_Type" description="Interpolation type used between the current keyframe and the next one" displayLabel="Interpolation">
            <ECCustomAttributes>
                <CustomHandledProperty/>
            </ECCustomAttributes>
        </ECProperty>
    </ECEntityClass>
	
    <ECEntityClass typeName="ColorKeyframe" description="Defines a keyframe for color change">
        <BaseClass>Keyframe</BaseClass>
        <ECCustomAttributes>
            <ClassHasHandler xmlns="BisCore.1.0"/>
        </ECCustomAttributes>
        <ECStructProperty propertyName="ColorValue" typeName="RgbColor" description="Color value ( if set the instance should be colored by the given value, null means that color is not overriden and the instance should be displayed with its original material )" displayLabel="Color Value"/>
    </ECEntityClass>
	
    <ECEntityClass typeName="VisibilityKeyframe" description="Defines a keyframe for transparency/visibility">
        <BaseClass>Keyframe</BaseClass>
        <ECCustomAttributes>
            <ClassHasHandler xmlns="BisCore.1.0"/>
        </ECCustomAttributes>
        <ECProperty propertyName="VisibilityValue" typeName="int" description="Visibility value ( 100 - instance is fully opaque, 0 - instance is invisible, null - visibility is not overriden )" displayLabel="Visibility Value">
            <ECCustomAttributes>
                <CustomHandledProperty/>
            </ECCustomAttributes>
        </ECProperty>
    </ECEntityClass>
	
    <ECEntityClass typeName="CuttingPlaneKeyframe" description="Defines a keyframe for clipping (growth simulation)">
        <BaseClass>Keyframe</BaseClass>
        <ECCustomAttributes>
            <ClassHasHandler xmlns="BisCore.1.0"/>
        </ECCustomAttributes>
        <ECStructProperty propertyName="CuttingPlane" typeName="Plane" description="Clipping plane parameter" displayLabel="Cutting Plane"/>
    </ECEntityClass>
	
	<!-- Question: how to represent 4x4 transfomation matrix in BIS? -->
    <ECEntityClass typeName="TransformationKeyframe" description="Defines a keyframe for movement: it stores 4x4 transformation matrix and optionally decomposed form of transformation for instance moving along 3D path ( M.position x M.oriemataion x M.pivot )">
        <BaseClass>Keyframe</BaseClass>
        <ECCustomAttributes>
            <ClassHasHandler xmlns="BisCore.1.0"/>
        </ECCustomAttributes>
        <ECArrayProperty propertyName="RelativeTransform" typeName="double" minOccurs="16" maxOccurs="16" isStruct="True" description="Transformation matrix 4x4 ( if set the instance should be post-transformed by the given value relative to its original position, null means that transformation is not overriden and the instance should be placed in its original position )" displayLabel="Relative Transform"/>
        <ECProperty propertyName="PathPosition" typeName="point3d" description="Translation" displayLabel="Path Position">
            <ECCustomAttributes>
                <HiddenProperty xmlns="CoreCustomAttributes.1.0"/>
                <CustomHandledProperty/>
            </ECCustomAttributes>
        </ECProperty>
        <ECStructProperty propertyName="PathOrientation" typeName="Quaternion" description="Orientation" displayLabel="Path Orientation"/>
        <ECProperty propertyName="PathPivot" typeName="point3d" description="Pre-translation" displayLabel="Path Pivot">
            <ECCustomAttributes>
                <HiddenProperty xmlns="CoreCustomAttributes.1.0"/>
                <CustomHandledProperty/>
            </ECCustomAttributes>
        </ECProperty>
    </ECEntityClass>

	<!-- Question: is there something similar in BIS and how is this compatible with Navigator? -->
    <ECStructClass typeName="RgbColor" description="Represents a color as three floating-point numbers">
        <ECProperty propertyName="Red" typeName="double" description="Red component [0.0;1.0]"/>
        <ECProperty propertyName="Green" typeName="double" description="Green component [0.0;1.0]"/>
        <ECProperty propertyName="Blue" typeName="double" description="Blue component [0.0;1.0]"/>
    </ECStructClass>
	
	<!-- Question: is there something similar in BIS and how is this compatible with Navigator? -->
    <ECStructClass typeName="Plane" description="Represents a plane in three-dimensional space as point and normal">
        <ECProperty propertyName="Position" typeName="point3d" description="Plane position"/>
        <ECProperty propertyName="Direction" typeName="point3d" description="Normalized direction vector"/>
    </ECStructClass>
	
	<!-- Question: is there something similar in BIS and how is this compatible with Navigator? -->
    <ECStructClass typeName="Quaternion" description="Represents a rotation in 3D space as unit quaternion">
        <ECProperty propertyName="X" typeName="double" description="X coordinate of vector part"/>
        <ECProperty propertyName="Y" typeName="double" description="Y coordinate of vector part"/>
        <ECProperty propertyName="Z" typeName="double" description="Z coordinate of vector part"/>
        <ECProperty propertyName="W" typeName="double" description="W coordinate ( scalar )"/>
    </ECStructClass>
	
    <ECRelationshipClass typeName="AnimationGroupGroupsSpatialElements" strength="referencing" strengthDirection="forward" modifier="None">
        <BaseClass>bis:ElementRefersToElements</BaseClass>
        <Source multiplicity="(0..1)" roleLabel="groups" polymorphic="true">
            <Class class="AnimationGroup"/>
        </Source>
        <Target multiplicity="(1..*)" roleLabel="is grouped by" polymorphic="true">
            <Class class="bis:SpatialElement"/>
        </Target>
    </ECRelationshipClass>

    <ECRelationshipClass typeName="AnimationInstanceAnimatesSpatialElement" strength="referencing" strengthDirection="forward" modifier="None">
        <BaseClass>bis:ElementRefersToElements</BaseClass>
        <Source multiplicity="(0..*)" roleLabel="animates" polymorphic="true">
            <Class class="AnimationInstance"/>
        </Source>
        <Target multiplicity="(0..1)" roleLabel="is animated by" polymorphic="true">
            <Class class="bis:SpatialElement"/>
        </Target>
    </ECRelationshipClass>

    <ECRelationshipClass typeName="AnimationInstanceAnimatesGroup" strength="referencing" strengthDirection="forward" modifier="None">
        <BaseClass>bis:ElementRefersToElements</BaseClass>
        <Source multiplicity="(0..*)" roleLabel="animates" polymorphic="true">
            <Class class="AnimationInstance"/>
        </Source>
        <Target multiplicity="(0..1)" roleLabel="is animated by" polymorphic="true">
            <Class class="AnimationGroup"/>
        </Target>
    </ECRelationshipClass>
	
    <ECRelationshipClass typeName="SimulationResultsConsistOfAnimationGroups" strength="embedding" strengthDirection="forward" modifier="None">
        <BaseClass>bis:ElementOwnsChildElements</BaseClass>
        <Source multiplicity="(1..1)" roleLabel="composes of" polymorphic="true">
            <Class class="SpatioTemporalSimulationResults"/>
        </Source>
        <Target multiplicity="(1..*)" roleLabel="is part of" polymorphic="true">
            <Class class="AnimationGroup"/>
        </Target>
    </ECRelationshipClass>
	
    <ECRelationshipClass typeName="SimulationResultsConsistOfAnimationInstances" strength="embedding" strengthDirection="forward" modifier="None">
        <BaseClass>bis:ElementOwnsChildElements</BaseClass>
        <Source multiplicity="(1..1)" roleLabel="composes of" polymorphic="true">
            <Class class="SpatioTemporalSimulationResults"/>
        </Source>
        <Target multiplicity="(1..*)" roleLabel="is part of" polymorphic="true">
            <Class class="AnimationInstance"/>
        </Target>
    </ECRelationshipClass>

    <ECRelationshipClass typeName="SimulationResultsOwnsCamera" strength="embedding" strengthDirection="forward" modifier="None">
        <BaseClass>bis:ElementOwnsChildElements</BaseClass>
        <Source multiplicity="(1..1)" roleLabel="owns" polymorphic="true">
            <Class class="SpatioTemporalSimulationResults"/>
        </Source>
        <Target multiplicity="(1..*)" roleLabel="is owned by" polymorphic="true">
            <Class class="Camera"/>
        </Target>
    </ECRelationshipClass>

    <ECRelationshipClass typeName="SimulatonResultsOwnsCameraKeyframes" strength="embedding" strengthDirection="forward" modifier="Sealed">
        <BaseClass>bis:ElementOwnsMultiAspects</BaseClass>
        <Source multiplicity="(1..1)" roleLabel="owns" polymorphic="true">
            <Class class="SpatioTemporalSimulationResults"/>
        </Source>
        <Target multiplicity="(0..*)" roleLabel="is owned by" polymorphic="false">
            <Class class="CameraKeyframe"/>
        </Target>
    </ECRelationshipClass>
	
    <ECRelationshipClass typeName="CameraKeyframeControlsCamera" strength="referencing" strengthDirection="forward" modifier="None">
        <Source multiplicity="(0..*)" roleLabel="controls" polymorphic="false">
            <Class class="CameraKeyframe"/>
        </Source>
        <Target multiplicity="(1..1)" roleLabel="is controlled by" polymorphic="true">
            <Class class="Camera"/>
        </Target>
    </ECRelationshipClass>

    <ECRelationshipClass typeName="AnimationInstanceOwnsKeyframes" strength="embedding" strengthDirection="forward" modifier="Sealed">
        <BaseClass>bis:ElementOwnsMultiAspects</BaseClass>
        <Source multiplicity="(1..1)" roleLabel="owns" polymorphic="true">
            <Class class="AnimationInstance"/>
        </Source>
        <Target multiplicity="(0..*)" roleLabel="is owned by" polymorphic="false">
            <Class class="Keyframe"/>
        </Target>
    </ECRelationshipClass>

    <ECEnumeration typeName="Interpolation_Type" backingTypeName="int" isStrict="true" description="Controls interpolation between neighbor animation keyframes at the timeline, Step means no interpolation">
        <ECEnumerator value="0" displayLabel="Step"/>
        <ECEnumerator value="1" displayLabel="Linear"/>
        <ECEnumerator value="2" displayLabel="Cubic"/>
    </ECEnumeration>
	
    <ECEnumeration typeName="CameraProjectionMode_Type" backingTypeName="int" isStrict="true" description="Controls how 3D scene is converted to 2 dimensions for viewing">
        <ECEnumerator value="0" displayLabel="Perspective"/>
        <ECEnumerator value="1" displayLabel="Isometric"/>
    </ECEnumeration>

</ECSchema>
