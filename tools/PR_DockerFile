FROM microsoft/vsts-cli:latest

ARG SAT
ARG PR_TITLE
ARG PR_SOURCE
ARG PR_DESC
ARG REPO_PATH
ARG PR_TARGET=master
ARG PR_REVIEWERS

## Copy whatever is in root to a directory
COPY ${REPO_PATH} ./repo
WORKDIR ./repo

# Authenticate VSTS
RUN vsts login --token ${SAT}

# Generate pull request
RUN vsts code pr create  -t ${PR_TARGET} -s ${PR_SOURCE} --title ${PR_TITLE} --delete-source-branch --description ${PR_DESC} --reviewers ${PR_REVIEWERS}